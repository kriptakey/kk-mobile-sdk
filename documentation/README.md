## Native demo: Internal only
- To compile SDK, we assume that you have installed Flutter SDK and Dart separately. It includes flutter dependency such as Android SDK and emulator
- Go to `/clientsdk/e2ee/e2ee_sdk_kotlin/e2ee_sdk_module`
- Run the following commands:
-- `flutter clean`
-- `flutter build aar`
- The library is generated in folder `/clientsdk/e2ee/e2ee_sdk_kotlin/e2ee_sdk_module/build/repo`
- After that, you can link the library location to your application gradle as written in the following steps.

## Native demo: Integrate to existing Application:
- Pre-requisite: you have android studio available in your current machine, including its SDK tools and device emulators.
- If you create the application by using Groovy DSL gradle, then you must comment `dependencyResolutionManagement` in settings.gradle, and move external repositories needed by the project to build.gradle (app):
```	
repositories {
    maven {
        url '/Users/sriyulianti/Development/KeyManage/clientsdk/e2ee/e2ee_sdk_kotlin/e2ee_sdk_module/build/host/outputs/repo' // KK E2EE SDK repo location
    }
    maven {
        url 'https://storage.googleapis.com/download.flutter.io' // flutter dependency
    }
    google() // Optional: your application dependency of repo
    mavenCentral() // Optional: your application dependency of repo 
}
```
- Add the following dependencies to your build.gradle:
```
dependencies {
    releaseImplementation ‘com.klaviskripta.e2ee_sdk_module:flutter_release:1.0’
    debugImplementation ‘com.klaviskripta.e2ee_sdk_module:flutter_release:1.0’
}
```
- Once the SDK and dependencies are linked to the gradle, now you can call SDK from your application. However, you need to instantiate flutter engine in order to call the API(s) in SDK.
```
fun initFlutter(context: Context): FlutterEngine {
    val loader = FlutterLoader()
    loader.startInitialization(context)
    loader.ensureInitializationComplete(context, null)
    val flutterEngine = FlutterEngine(context)
    flutterEngine.dartExecutor.executeDartEntrypoint(
        DartExecutor
            .DartEntrypoint
            .createDefault()
    )
    GeneratedPluginRegister.registerGeneratedPlugins(flutterEngine)
    return flutterEngine
}
```

- Instantiate the constructor as below:
```
val initFlutterConstructor = InitFlutter()
val flutterEngine = initFlutterConstructor.initFlutter(this)
val e2eeSdkPlugin = E2eeSdkPlugin.fromEngine(flutterEngine)
```

- To call the methods in SDK, you have to wrap it in a scope since SDK is developed by using asynchronous method. Here is the example:
```
launch {
    val responseServerPublickey =
        e2eeSdkPlugin.getRSAPublicKeyPemFromCertificate(String(certificateBytes))

    // TODO: Execute your function in this scope. Otherwise, you cannot get the SDK result outside of this scope.
}
```

- To be able calling the SDK methods, you need to add CoroutineScope() object to the activity class. Here is the example:
```
class MainActivity : AppCompatActivity(), CoroutineScope {
    ....

    private var job: Job = Job()
    override val coroutineContext: CoroutineContext
        get() = Dispatchers.Main + job

    override fun onDestroy() {
        super.onDestroy()
        job.cancel()
    }

    override fun onCreate(savedInstanceState: Bundle?) {
        ....

        launch {
            val responseServerPublickey =
                e2eeSdkPlugin.getRSAPublicKeyPemFromCertificate(String(certificateBytes))

            // TODO: Execute your function in this scope. Otherwise, you cannot get the SDK result outside of this scope.
            }
    }
}
```

- Pin the KMS certificate that is generated by using `clikk cert self-sign` which key ID has been defined previously.

## Flutter demo: 
- There are two sample demos: `e2ee_device_binding_demo_flutter` and `e2ee_dp_demo_flutter`.
- `e2ee_device_binding_demo_flutter` presents the scenario of using KK mobile SDK to register device and performs device binding use case.
- `e2ee_dp_demo_flutter` presents data protection demo in where the device is not registered by using device binding scenario.
- To run each demo app, the developer must already install flutter environment and the simulators. For instance: Android emulator.
- Adjust the linking of mobile SDK path in each `pubspec.yaml`. For instance in `e2ee_dp_demo_flutter`, adjust the following library paths in `pubspec.yaml`:
    -- kms_e2ee_package:
        path: ../../sdk-flutter/kms_e2ee_package // The current repository of SDK flutter.
- Once you update the linking, run `flutter pub get` from the main directory of the sample demo. Make sure that the hosted library is also downloaded.
- Update the pinned certificate in `assets` folder by replacing the existing certificate with the certificate you create in KMS.
- Replace the `host:port` to `host:port` of your database server.
- Finally, you can run the dmeo app, by clicking button `run` in the main function inside `main.dart` file.

## Backend Server Demo: NodeJS
- Prerequisite: you have MySQL setup and environment in your local device. It includes npm and node
- Create a database by using MySQL statements written on user.sql.
- Adjust variables in .env file to be synchronized with KMS server and MySQL server.
- Run `npm i` to download all node dependencies
- Run `npm start` to run the server

## KMS Development
- Generate AES key which purpose encryption
- Generate AES key which purpose wrapping
- Generate RSA key 2048 which purpose signing
- Generate self signed certficate by using the above RSA key
- Register application and get the certificate as well as its private key.





